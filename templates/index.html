<!DOCTYPE html>
<html lang="en">
<head>

<title>Optimization of Drug Inventory â€‹</title>
<meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

</head>
<!-- <body style="background-color: #adb5bd;"> -->
<body>
<div class="container-md">
<p class="border-bottom fs-2 text-center">Optimization of Drug Inventory</p>

<div class="form-floating">
	<select class="form-select drug_ids" id="floatingSelect" aria-label="Floating label select example">
	  <option selected>Open this select menu</option>
	</select>
	<label for="floatingSelect">Drug ID</label>
  </div><br>

  <div id="keyparam" class="container-md border">
	<p class="border-bottom fs-4">Key Parameters</p>
	
  <div class="row g-3">
	<div class="col-md-6">
		<label for="DemandCategory" class="form-label">Demand Category</label>
		<input type="text" class="form-control" id="DemandCategory"  readonly>
	  </div>
	  <div class="col-md-6">
		<label for="CostCategory" class="form-label">Cost Category(Normalized CPU)</label>
		<input type="text" class="form-control" id="CostCategory"  readonly>
	  </div>
 
	<div class="col-md-6">
		<label for="DemandVolatility" class="form-label">Demand Volatility</label>
		<input type="text" class="form-control" id="DemandVolatility"  readonly>
	  </div>
	  <div class="col-md-6">
		<label for="Costper_unit" class="form-label">Cost per unit</label>
		<input type="text" class="form-control" id="Costper_unit"  readonly>
	  </div>

	<div class="col-md-6">
		<label for="weeklydemand" class="form-label">Average weekly demand</label>
		<input type="text" class="form-control" id="weeklydemand"  readonly>
	  </div>
	  <div class="col-md-6">
		<label for="MaxDemand" class="form-label">Max Demand in a week</label>
		<input type="text" class="form-control" id="MaxDemand"  readonly>
	  </div>
  </div>
  <br>
</div>

<br>
<div id="availablestock" class="container-md border">
	<div id="" class="row g-3 p-2">
		<div class="col-auto">
		<label for="staticEmail2" class="visually-hidden">Available stock</label>
		<input type="text" readonly class="form-control-plaintext" id="staticEmail2" value="Available stock">
		</div>
		<div class="col-auto">
		<label for="inputavailablestock" class="visually-hidden">Available stock value</label>
		<input type="number" class="form-control" id="inputavailablestock" placeholder="Available stock in number">
		</div>
		<div class="col-auto">
		<button type="button" class="btn btn-primary mb-3" id="btn-predict">Predict</button>
		</div>
	</div>
</div>

<br>
  <div id="ordermanagement" class="container-md border">
	<p class="border-bottom fs-4">Order management</p>
	
  <div class="row g-3">
	<div class="col-md-6">
		<label for="Demandnextweeks" class="form-label">Predicted demand for next 2 weeks</label>
		<input type="text" class="form-control" id="Demandnextweeks"  readonly>
	  </div>
	  <div class="col-md-6">
		<label for="reorder" class="form-label">Re-order</label>
		<input type="text" class="form-control" id="reorder"  readonly>
	  </div>

	<div class="col-md-6">
		<label for="reorderpoint" class="form-label">Re-order Point</label>
		<input type="text" class="form-control" id="reorderpoint"  readonly>
	  </div>
	  <div class="col-md-6">
		<label for="reorderqty" class="form-label">Re-order Qty</label>
		<input type="text" class="form-control" id="reorderqty"  readonly>
	  </div>

	<div class="col-md-6">
		<label for="safetystock" class="form-label">Safety Stock</label>
		<input type="text" class="form-control" id="safetystock"  readonly>
	  </div>
	 
  </div><br>
</div>
</div>
</body>

<script src="{{ url_for('static', filename='scripts/jquery.min.js') }}"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

<script type="text/javascript">

$(document).ready(function () {
	
	$.ajax({
		method: "GET",
		contentType: 'application/json',
		url: "get_all_drugs",
		data: {},
		timeout: 600000,
		success: function (data) {

			$.each( data['output'], function( i, val ) {
				$(".drug_ids").append('<option value="'+val+'">'+val+'</option>');
				});

		},
		error: function (e) {

			$("#result").text(e.responseText);
			console.log("ERROR : ", e);
			$(".json-result").hide();
			$(".json-error").show();
			$(".error-message").text(e.responseJSON.message);
			$("#btnSubmit").prop("", false);

		}
	});


	$('.drug_ids').on('change', function (e) {
    var optionSelected = $("option:selected", this);
    var valueSelected = this.value;
	console.log("optionSelected : ", optionSelected);

	$.ajax({
		method: "POST",
		contentType: 'application/json',
		url: "get_drug_data",
		data: JSON.stringify({'drug_id':valueSelected}),
		timeout: 600000,
		success: function (data) {
			output = data['output']
			$("#DemandCategory").val(output['Demand_Category'])
			$("#CostCategory").val(output['COST_CAT_TAG'])
			$("#DemandVolatility").val(output['DEMAND_VOLATILITY'])
			$("#Costper_unit").val(output['COST_PER_UNIT'].toFixed(2))
			$("#weeklydemand").val(output['AVG_WEEKLY_DEMAND'].toFixed(2))
			$("#MaxDemand").val(output['Max_Weekly_Demand'])


		},
		error: function (e) {

			$("#result").text(e.responseText);
			console.log("ERROR : ", e);
			$(".json-result").hide();
			$(".json-error").show();
			$(".error-message").text(e.responseJSON.message);
			$("#btnSubmit").prop("", false);

		}
	});


});




$("#btnSubmit").prop("", true);

$('INPUT[type="file"]').change(function () {
    var ext = this.value.match(/\.(.+)$/)[1];
	var file_format = new Array('csv', 'xlsx', 'xls', 'xlsm');
	if (jQuery.inArray(ext, file_format) == -1) 
	{alert('"'+ext + '" is not an allowed file type.');
	$("#btnSubmit").prop("", true);}
	else{$("#btnSubmit").prop("", false);}

});

$("#btn-predict").click(function (event) {
	var data = {'drug_id':$('.drug_ids').val(), 'avail_stock':$('#inputavailablestock').val()};
	console.log(data);
	$.ajax({
		method: "POST",
		contentType: 'application/json',
		url: "get_drug_prediction",
		data: JSON.stringify(data),
		timeout: 600000,
		success: function (data) {
			output = data['output']
			$("#reorder").val(output["predicted_reorder"]);
			$("#Demandnextweeks").val(output["prediction_next_two_weeks"]);
			$("#reorderpoint").val(output["reorder_point"]);
			$("#reorderqty").val(output["reorder_qty"]);
			$("#safetystock").val(output["safety_stock"]);
			
		},
		error: function (e) {

			$("#result").text(e.responseText);
			console.log("ERROR : ", e);
			$(".json-result").hide();
			$(".json-error").show();
			$(".error-message").text(e.responseJSON.message);
			$("#btnSubmit").prop("", false);

		}
	});

});

});
</script>
</html>